var J=Object.defineProperty,K=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var j=(e,a,r)=>a in e?J(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,E=(e,a)=>{for(var r in a||(a={}))W.call(a,r)&&j(e,r,a[r]);if(Y)for(var r of Y(a))X.call(a,r)&&j(e,r,a[r]);return e},R=(e,a)=>K(e,Q(a));import{B as k,r as S,t as P,e as d,y as z,f as u,q as p,w as n,h as o,k as t,z as M,g as q,A as O,F as L,E as $,l as _,d as Z,u as ee,o as le,i as A,j as I,p as oe,m as ae}from"./vendor.7b1bb722.js";import{_ as G,a as V}from"./index.344ea3cc.js";const ne={name:"DialogAssignExam",props:{reload:Function},setup(e,a){const r=k(null),l=S({loading:!1,matchExams:[],visible:!1,formData:{uid:0,exam_id:"",time_range:[]},rules:{exam_id:[{required:"true"}]}}),g=async()=>{let i=await V.listUserMatchExams({uid:l.formData.uid});l.matchExams=i.data},b=i=>{l.formData.uid=i,l.matchExams.length==0&&(l.loading=!0,g(),l.loading=!1),l.visible=!0},s=()=>{r.value.validate(async i=>{if(i){let m=await V.storeExamUser(l.formData);l.visible=!1,$.success(m.msg),e.reload&&e.reload()}})};return R(E({},P(l)),{handleSubmit:s,formRef:r,open:b})}},te=o("div",{class:"time-range-help-text"},"If the time range is not specified, the exam's own configured time range will be used.",-1),se={class:"dialog-footer"},de=_("Cancel"),ie=_("Save");function re(e,a,r,l,g,b){const s=d("el-option"),i=d("el-select"),m=d("el-form-item"),f=d("el-date-picker"),h=d("el-form"),C=d("el-button"),w=d("el-dialog"),U=z("loading");return u(),p(w,{title:"Assign exam to user",modelValue:e.visible,"onUpdate:modelValue":a[3]||(a[3]=c=>e.visible=c),center:"","close-on-click-modal":!1},{footer:n(()=>[o("span",se,[t(C,{onClick:a[2]||(a[2]=c=>e.visible=!1)},{default:n(()=>[de]),_:1}),t(C,{type:"primary",onClick:l.handleSubmit},{default:n(()=>[ie]),_:1},8,["onClick"])])]),default:n(()=>[M((u(),p(h,{model:e.formData,"label-width":"100px",ref:"formRef",rules:e.rules},{default:n(()=>[t(m,{label:"Exam",prop:"exam_id"},{default:n(()=>[t(i,{modelValue:e.formData.exam_id,"onUpdate:modelValue":a[0]||(a[0]=c=>e.formData.exam_id=c),placeholder:"Select an exam..."},{default:n(()=>[(u(!0),q(L,null,O(e.matchExams,c=>(u(),p(s,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"Time range",prop:"time_range"},{default:n(()=>[t(f,{modelValue:e.formData.time_range,"onUpdate:modelValue":a[1]||(a[1]=c=>e.formData.time_range=c),type:"datetimerange",format:"YYYY-MM-DD HH:mm:ss","range-separator":"to","start-placeholder":"Begin","end-placeholder":"End"},null,8,["modelValue"]),te]),_:1})]),_:1},8,["model","rules"])),[[U,e.loading]])]),_:1},8,["modelValue"])}var me=G(ne,[["render",re]]);const ue={name:"DialogInviteInfo",props:{reload:Function},setup(e,a){const r=k(null),l=S({loading:!1,visible:!1,uid:0,inviteInfo:[]}),g=async()=>{let s=await V.getInviteInfo({uid:l.uid});l.inviteInfo.push(s.data)},b=s=>{l.uid=s,l.inviteInfo.length==0&&(l.loading=!0,g(),l.loading=!1),l.visible=!0};return R(E({},P(l)),{formRef:r,open:b})}};function fe(e,a,r,l,g,b){const s=d("el-table-column"),i=d("el-table"),m=d("el-dialog"),f=z("loading");return u(),p(m,{title:"Invite info",modelValue:e.visible,"onUpdate:modelValue":a[0]||(a[0]=h=>e.visible=h),center:"",width:"65%","close-on-click-modal":!1},{default:n(()=>[M((u(),p(i,{data:e.inviteInfo},{default:n(()=>[t(s,{prop:"id",label:"ID",width:"55"}),t(s,{prop:"inviter_user.username",label:"Inviter",width:"150"}),t(s,{prop:"invitee",label:"Receive email"}),t(s,{prop:"hash",label:"Hash"}),t(s,{prop:"valid_text",label:"Hash valid",width:"100"}),t(s,{prop:"invitee_register_email",label:"Register email"}),t(s,{prop:"time_invited",label:"Time invited",width:"160"})]),_:1},8,["data"])),[[f,e.loading]])]),_:1},8,["modelValue"])}var ce=G(ue,[["render",fe]]);const _e={name:"DialogDisableUser",props:{reload:Function},setup(e,a){const r=k(null),l=S({loading:!1,visible:!1,formData:{uid:0,reason:""},rules:{reason:[{required:"true"}]}}),g=s=>{l.formData.uid=s,l.visible=!0},b=()=>{r.value.validate(async s=>{if(s){let i=await V.disableUser(l.formData);l.visible=!1,$.success(i.msg),e.reload&&e.reload()}})};return R(E({},P(l)),{handleSubmit:b,formRef:r,open:g})}},pe={class:"dialog-footer"},ve=_("Cancel"),ge=_("Save");function be(e,a,r,l,g,b){const s=d("el-input"),i=d("el-form-item"),m=d("el-form"),f=d("el-button"),h=d("el-dialog"),C=z("loading");return u(),p(h,{title:"Disable user",modelValue:e.visible,"onUpdate:modelValue":a[2]||(a[2]=w=>e.visible=w),center:"","close-on-click-modal":!1},{footer:n(()=>[o("span",pe,[t(f,{onClick:a[1]||(a[1]=w=>e.visible=!1)},{default:n(()=>[ve]),_:1}),t(f,{type:"primary",onClick:l.handleSubmit},{default:n(()=>[ge]),_:1},8,["onClick"])])]),default:n(()=>[M((u(),p(m,{model:e.formData,"label-width":"100px",ref:"formRef",rules:e.rules},{default:n(()=>[t(i,{label:"Reason",prop:"reason"},{default:n(()=>[t(s,{type:"textarea",modelValue:e.formData.reason,"onUpdate:modelValue":a[0]||(a[0]=w=>e.formData.reason=w)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[C,e.loading]])]),_:1},8,["modelValue"])}var he=G(_e,[["render",be]]);const we={name:"DialogModComment",props:{reload:Function},setup(e,a){const r=k(null),l=S({loading:!1,visible:!1,uid:0,modComment:""}),g=async()=>{let s=await V.getUserModComment({uid:l.uid});l.modComment=s.data},b=s=>{l.uid=s,l.modComment||(l.loading=!0,g(),l.loading=!1),l.visible=!0};return R(E({},P(l)),{formRef:r,open:b})}},De=["innerHTML"];function Ie(e,a,r,l,g,b){const s=d("el-card"),i=d("el-dialog"),m=z("loading");return u(),p(i,{title:"Mod comment",modelValue:e.visible,"onUpdate:modelValue":a[0]||(a[0]=f=>e.visible=f),center:"",width:"40%","close-on-click-modal":!1},{default:n(()=>[M((u(),p(s,null,{default:n(()=>[o("div",{innerHTML:e.modComment,class:"pre-line"},null,8,De)]),_:1})),[[m,e.loading]])]),_:1},8,["modelValue"])}var ye=G(we,[["render",Ie]]);const Ce={name:"DialogResetPassword",props:{reload:Function},setup(e,a){const r=k(null),l=S({loading:!1,visible:!1,formData:{uid:0,password:"",password_confirmation:""},rules:{password:[{required:"true"}],password_confirmation:[{required:"true"}]}}),g=s=>{l.formData.uid=s,l.visible=!0},b=()=>{r.value.validate(async s=>{if(s){let i=await V.resetPassword(l.formData);l.visible=!1,$.success(i.msg),e.reload&&e.reload()}})};return R(E({},P(l)),{handleSubmit:b,formRef:r,open:g})}},Ve={class:"dialog-footer"},ke=_("Cancel"),$e=_("Save");function Ue(e,a,r,l,g,b){const s=d("el-input"),i=d("el-form-item"),m=d("el-form"),f=d("el-button"),h=d("el-dialog"),C=z("loading");return u(),p(h,{title:"Reset password",modelValue:e.visible,"onUpdate:modelValue":a[3]||(a[3]=w=>e.visible=w),center:"","close-on-click-modal":!1},{footer:n(()=>[o("span",Ve,[t(f,{onClick:a[2]||(a[2]=w=>e.visible=!1)},{default:n(()=>[ke]),_:1}),t(f,{type:"primary",onClick:l.handleSubmit},{default:n(()=>[$e]),_:1},8,["onClick"])])]),default:n(()=>[M((u(),p(m,{model:e.formData,"label-width":"200px",ref:"formRef",rules:e.rules},{default:n(()=>[t(i,{label:"Password",prop:"password"},{default:n(()=>[t(s,{modelValue:e.formData.password,"onUpdate:modelValue":a[0]||(a[0]=w=>e.formData.password=w)},null,8,["modelValue"])]),_:1}),t(i,{label:"Password confirmation",prop:"password_confirmation"},{default:n(()=>[t(s,{modelValue:e.formData.password_confirmation,"onUpdate:modelValue":a[1]||(a[1]=w=>e.formData.password_confirmation=w)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[C,e.loading]])]),_:1},8,["modelValue"])}var Ee=G(Ce,[["render",Ue]]);const Re={name:"DialogGrantMedal",props:{reload:Function},setup(e,a){const r=k(null),l=S({loading:!1,medals:[],visible:!1,formData:{uid:0,medal_id:"",duration:""},rules:{medal_id:[{required:"true"}]}}),g=async()=>{let i=await V.listMedal();l.medals=i.data.data},b=i=>{l.formData.uid=i,l.medals.length==0&&(l.loading=!0,g(),l.loading=!1),l.visible=!0},s=()=>{r.value.validate(async i=>{if(i){let m=await V.storeUserMedal(l.formData);l.visible=!1,$.success(m.msg),e.reload&&e.reload()}})};return R(E({},P(l)),{handleSubmit:s,formRef:r,open:b})}},Me={class:"dialog-footer"},Ae=_("Cancel"),Se=_("Save");function Pe(e,a,r,l,g,b){const s=d("el-option"),i=d("el-select"),m=d("el-form-item"),f=d("el-input"),h=d("el-form"),C=d("el-button"),w=d("el-dialog"),U=z("loading");return u(),p(w,{title:"Grant medal to user",modelValue:e.visible,"onUpdate:modelValue":a[3]||(a[3]=c=>e.visible=c),center:"","close-on-click-modal":!1},{footer:n(()=>[o("span",Me,[t(C,{onClick:a[2]||(a[2]=c=>e.visible=!1)},{default:n(()=>[Ae]),_:1}),t(C,{type:"primary",onClick:l.handleSubmit},{default:n(()=>[Se]),_:1},8,["onClick"])])]),default:n(()=>[M((u(),p(h,{model:e.formData,"label-width":"100px",ref:"formRef",rules:e.rules},{default:n(()=>[t(m,{label:"Medal",prop:"medal_id"},{default:n(()=>[t(i,{modelValue:e.formData.medal_id,"onUpdate:modelValue":a[0]||(a[0]=c=>e.formData.medal_id=c),placeholder:"Select an medal..."},{default:n(()=>[(u(!0),q(L,null,O(e.medals,c=>(u(),p(s,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"Duration",prop:"duration"},{default:n(()=>[t(f,{modelValue:e.formData.duration,"onUpdate:modelValue":a[1]||(a[1]=c=>e.formData.duration=c),placeholder:"Unit: day, if empty, it's valid forever"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[U,e.loading]])]),_:1},8,["modelValue"])}var ze=G(Re,[["render",Pe]]);const Ge={name:"UserDetail",components:{DialogAssignExam:me,DialogViewInviteInfo:ce,DialogDisableUser:he,DialogModComment:ye,DialogResetPassword:Ee,DialogGrantMedal:ze},setup(){const e=Z();ee();const{id:a}=e.query,r=k(null),l=k(null),g=k(null),b=k(null),s=k(null),i=k(null),m=S({loading:!1,baseInfo:{},examInfo:null});le(()=>{f()});const f=async()=>{m.loading=!0;let y=await V.getUser(a);m.loading=!1,m.baseInfo=y.data.base_info,m.examInfo=y.data.exam_info},h=async y=>{let D=await V.deleteExamUser(y);$.success(D.msg),await f()},C=async y=>{let D=await V.avoidExamUser(y);$.success(D.msg),await f()},w=async y=>{let D=await V.recoverExamUser(y);$.success(D.msg),await f()},U=async()=>{r.value.open(a)},c=async()=>{l.value.open(a)},F=async()=>{g.value.open(a)},B=async()=>{b.value.open(a)},x=async()=>{let y=await V.enableUser({uid:a});$.success(y.msg),await f()},N=async()=>{s.value.open(a)},H=async()=>{i.value.open(a)},T=async y=>{let D=await V.removeUserMedal(y);$.success(D.msg),await f()};return R(E({},P(m)),{handleRemoveExam:h,handleAvoidExam:C,handleAssignExam:U,handleGrantMedal:c,handleRecoverExam:w,handleEnableUser:x,handleViewInviteInfo:F,handleDisableUser:B,handleGetModComment:N,handleResetPassword:H,fetchPageData:f,handleRemoveUserMedal:T,assignExam:r,grantMedal:l,viewInviteInfo:g,disableUser:b,modComment:s,resetPassword:i})}},v=e=>(oe("data-v-0ec9c9f6"),e=e(),ae(),e),qe={class:"page-user-detail"},Fe=v(()=>o("div",{class:"card-header"},[o("span",null,"Base info")],-1)),Be={class:"table-base-info"},xe=v(()=>o("tr",null,[o("th",null,"Field"),o("th",null,"Value"),o("th",null,"Actions"),o("th",null,"Other")],-1)),Ne=v(()=>o("td",null,"Username",-1)),He=v(()=>o("td",null,null,-1)),Te={colspan:"11"},Le={class:"other-actions"},Ye=_("Mod comment"),je=_("Reset password"),Oe=_("Assign exam"),Je=_("Grant medal"),Ke=v(()=>o("td",null,"Email",-1)),Qe=_("Change"),We=v(()=>o("td",null,"Enabled",-1)),Xe=_("Disable"),Ze=_("Enable"),el=v(()=>o("td",null,"Added",-1)),ll=v(()=>o("td",null,"Last access",-1)),ol=v(()=>o("td",null,"Class",-1)),al=v(()=>o("td",null,"Invite by",-1)),nl=_("View"),tl=v(()=>o("td",null,"Uploaded",-1)),sl=_("Add"),dl=v(()=>o("td",null,"Downloaded",-1)),il=_("Add"),rl=v(()=>o("td",null,"Seed points",-1)),ml=v(()=>o("td",null,"Bonus",-1)),ul=_("Add"),fl=v(()=>o("div",{class:"card-header"},[o("span",null,"Exam on the way")],-1)),cl={class:"table-base-info"},_l=v(()=>o("td",null,"Name",-1)),pl=v(()=>o("td",null,"Created at",-1)),vl=v(()=>o("td",null,"Exam time",-1)),gl=v(()=>o("td",null,"Status",-1)),bl=v(()=>o("td",null,"Action",-1)),hl=_("Remove"),wl=_("Avoid"),Dl=_("Recover"),Il=_("Pass !"),yl=_("Not Pass !"),Cl=v(()=>o("div",{class:"card-header"},[o("span",null,"Medal")],-1)),Vl=v(()=>o("a",{style:{cursor:"pointer"}},"Remove",-1));function kl(e,a,r,l,g,b){const s=d("el-button"),i=d("el-popconfirm"),m=d("el-card"),f=d("el-col"),h=d("el-table-column"),C=d("el-tag"),w=d("el-table"),U=d("el-row"),c=d("el-image"),F=d("DialogAssignExam"),B=d("DialogGrantMedal"),x=d("DialogViewInviteInfo"),N=d("DialogDisableUser"),H=d("DialogModComment"),T=d("DialogResetPassword"),y=z("loading");return u(),q(L,null,[M((u(),q("div",qe,[t(m,null,{header:n(()=>[Fe]),default:n(()=>[o("table",Be,[xe,o("tr",null,[Ne,o("td",null,I(e.baseInfo.username),1),He,o("td",Te,[o("div",Le,[t(s,{type:"primary",size:"default",onClick:l.handleGetModComment},{default:n(()=>[Ye]),_:1},8,["onClick"]),t(s,{type:"primary",size:"default",onClick:l.handleResetPassword},{default:n(()=>[je]),_:1},8,["onClick"]),t(s,{type:"primary",size:"default",onClick:l.handleAssignExam},{default:n(()=>[Oe]),_:1},8,["onClick"]),t(s,{type:"primary",size:"default",onClick:l.handleGrantMedal},{default:n(()=>[Je]),_:1},8,["onClick"])])])]),o("tr",null,[Ke,o("td",null,I(e.baseInfo.email),1),o("td",null,[t(s,{size:"small"},{default:n(()=>[Qe]),_:1})])]),o("tr",null,[We,o("td",null,I(e.baseInfo.enabled),1),o("td",null,[e.baseInfo.enabled&&e.baseInfo.enabled=="yes"?(u(),p(s,{key:0,size:"small",onClick:l.handleDisableUser},{default:n(()=>[Xe]),_:1},8,["onClick"])):A("",!0),e.baseInfo.enabled&&e.baseInfo.enabled=="no"?(u(),p(i,{key:1,title:"Confirm Enable ?",onConfirm:l.handleEnableUser},{reference:n(()=>[t(s,{size:"small"},{default:n(()=>[Ze]),_:1})]),_:1},8,["onConfirm"])):A("",!0)])]),o("tr",null,[el,o("td",null,I(e.baseInfo.added),1)]),o("tr",null,[ll,o("td",null,I(e.baseInfo.last_access),1)]),o("tr",null,[ol,o("td",null,I(e.baseInfo.class_text),1)]),o("tr",null,[al,o("td",null,I(e.baseInfo.inviter&&e.baseInfo.inviter.username),1),o("td",null,[t(s,{size:"small",onClick:l.handleViewInviteInfo},{default:n(()=>[nl]),_:1},8,["onClick"])])]),o("tr",null,[tl,o("td",null,I(e.baseInfo.uploaded_text),1),o("td",null,[t(s,{size:"small"},{default:n(()=>[sl]),_:1})])]),o("tr",null,[dl,o("td",null,I(e.baseInfo.downloaded_text),1),o("td",null,[t(s,{size:"small"},{default:n(()=>[il]),_:1})])]),o("tr",null,[rl,o("td",null,I(e.baseInfo.seed_points),1)]),o("tr",null,[ml,o("td",null,I(e.baseInfo.bonus),1),o("td",null,[t(s,{size:"small"},{default:n(()=>[ul]),_:1})])])])]),_:1}),e.examInfo?(u(),p(m,{key:0},{header:n(()=>[fl]),default:n(()=>[t(U,null,{default:n(()=>[t(f,{span:12},{default:n(()=>[o("table",cl,[o("tr",null,[_l,o("td",null,I(e.examInfo.exam&&e.examInfo.exam.name),1)]),o("tr",null,[pl,o("td",null,I(e.examInfo.created_at),1)]),o("tr",null,[vl,o("td",null,I(e.examInfo.begin)+" ~ "+I(e.examInfo.end),1)]),o("tr",null,[gl,o("td",null,I(e.examInfo.status_text),1)]),o("tr",null,[bl,o("td",null,[t(i,{title:"Confirm Remove ?",onConfirm:a[0]||(a[0]=D=>l.handleRemoveExam(e.examInfo.id))},{reference:n(()=>[t(s,{type:"danger",size:"small"},{default:n(()=>[hl]),_:1})]),_:1}),e.examInfo.status===0?(u(),p(i,{key:0,title:"Confirm Avoid ?",onConfirm:a[1]||(a[1]=D=>l.handleAvoidExam(e.examInfo.id))},{reference:n(()=>[t(s,{type:"info",size:"small"},{default:n(()=>[wl]),_:1})]),_:1})):A("",!0),e.examInfo.status===-1?(u(),p(i,{key:1,title:"Confirm Recover ?",onConfirm:a[2]||(a[2]=D=>l.handleRecoverExam(e.examInfo.id))},{reference:n(()=>[t(s,{type:"primary",size:"small"},{default:n(()=>[Dl]),_:1})]),_:1})):A("",!0)])])])]),_:1}),t(f,{span:12},{default:n(()=>[t(w,{data:e.examInfo.progress_formatted},{default:n(()=>[t(h,{prop:"name",label:"Index"}),t(h,{prop:"require_value_formatted",label:"Require"}),t(h,{prop:"current_value_formatted",label:"Current"}),t(h,{prop:"result",label:"Result"},{default:n(D=>[D.row.passed?(u(),p(C,{key:0,type:"success"},{default:n(()=>[Il]),_:1})):A("",!0),D.row.passed?A("",!0):(u(),p(C,{key:1,type:"danger"},{default:n(()=>[yl]),_:1}))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})):A("",!0),e.baseInfo.valid_medals&&e.baseInfo.valid_medals.length?(u(),p(U,{key:1},{default:n(()=>[t(f,{span:12},{default:n(()=>[t(m,null,{header:n(()=>[Cl]),default:n(()=>[M((u(),p(w,{ref:"multipleTable",data:e.baseInfo.valid_medals,"tooltip-effect":"dark"},{default:n(()=>[t(h,{prop:"name",label:"Name"}),t(h,{prop:"image_large",label:"Image"},{default:n(D=>[t(c,{src:D.row.image_large,style:{"max-height":"200px"}},null,8,["src"])]),_:1}),t(h,{prop:"expire_at",label:"Expire at"}),t(h,{label:"Action",width:"100"},{default:n(D=>[t(i,{title:"Confirm Remove ?",onConfirm:$l=>l.handleRemoveUserMedal(D.row.user_medal_id)},{reference:n(()=>[Vl]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[y,e.loading]])]),_:1})]),_:1})]),_:1})):A("",!0)])),[[y,e.loading]]),t(F,{ref:"assignExam",reload:l.fetchPageData},null,8,["reload"]),t(B,{ref:"grantMedal",reload:l.fetchPageData},null,8,["reload"]),t(x,{ref:"viewInviteInfo"},null,512),t(N,{ref:"disableUser",reload:l.fetchPageData},null,8,["reload"]),t(H,{ref:"modComment"},null,512),t(T,{ref:"resetPassword"},null,512)],64)}var Ml=G(Ge,[["render",kl],["__scopeId","data-v-0ec9c9f6"]]);export{Ml as default};
