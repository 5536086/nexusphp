var N=Object.defineProperty,I=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var w=(t,e,i)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,C=(t,e)=>{for(var i in e||(e={}))T.call(e,i)&&w(t,i,e[i]);if(H)for(var i of H(e))A.call(e,i)&&w(t,i,e[i]);return t},E=(t,e)=>I(t,S(e));import{G as R,B as $,d as F,u as G,r as L,o as O,H as W,t as z,e as m,f as D,g as Y,k as a,w as l,E as J,F as U,A as j,l as u,h as K,q as B,j as h,i as P}from"./vendor.51c5b88d.js";import{_ as Q,b as X,a as b}from"./index.e27bf721.js";const Z={name:"ExamForm",setup(){const{proxy:t}=R();console.log("proxy",t);const e=$(null),i=F(),v=G(),{id:f}=i.query,n=L({token:X("token")||"",id:f,allClasses:[],formData:{name:"",description:"",begin:"",end:"",duration:"",indexes:[],filters:{classes:[],register_time_range:[],donate_status:[]},status:"",is_discovered:""},rules:{name:[{required:"true"}],indexes:[{required:"true"}],status:[{required:"true"}],is_discovered:[{required:"true"}]}});O(async()=>{await V(),await c(),f&&b.getExam(f).then(s=>{n.formData.name=s.data.name,n.formData.description=s.data.description,n.formData.begin=s.data.begin,n.formData.end=s.data.end,n.formData.duration=s.data.duration,n.formData.indexes=s.data.indexes,n.formData.filters=s.data.filters,n.formData.status=s.data.status,n.formData.is_discovered=s.data.is_discovered})}),W(()=>{});const p=()=>{e.value.validate(async s=>{if(s){let r=n.formData;console.log(r),r.begin&&(r.begin=dayjs(r.begin).format("YYYY-MM-DD HH:mm:ss")),r.end&&(r.end=dayjs(r.end).format("YYYY-MM-DD HH:mm:ss")),r.filters.register_time_range&&r.filters.register_time_range[0]&&(r.filters.register_time_range[0]=dayjs(r.filters.register_time_range[0]).format("YYYY-MM-DD HH:mm:ss")),r.filters.register_time_range&&r.filters.register_time_range[1]&&(r.filters.register_time_range[1]=dayjs(r.filters.register_time_range[1]).format("YYYY-MM-DD HH:mm:ss")),console.log(r),f?await b.updateExam(f,r):await b.storeExam(r),await v.push({name:"exam"})}})},d=s=>{const r=s.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(r))return J.error("\u8BF7\u4E0A\u4F20 jpg\u3001jpeg\u3001png \u683C\u5F0F\u7684\u56FE\u7247"),!1},_=s=>{n.formData.goodsCoverImg=s.data||""},g=s=>{n.categoryId=s[2]||0},V=async()=>{let s=await b.listClass();n.allClasses=s.data},c=async()=>{let s=await b.listExamIndex();n.formData.indexes=s.data};return E(C({},z(n)),{formRef:e,submitAdd:p,handleBeforeUpload:d,handleUrlSuccess:_,handleChangeCate:g})}},ee=u("Enabled"),ae=u("Disabled"),te=u("No"),le=u("Yes"),oe=K("div",{style:{color:"#aaa"}},"Unit: days. When assign to user, begin and end are used if they are specified. Otherwise begin time is the time at assignment, and the end time is the time at assignment plus the duration.",-1),se=u("No"),re=u("Yes"),ne=u("Submit");function de(t,e,i,v,f,n){const p=m("el-input"),d=m("el-form-item"),_=m("el-checkbox"),g=m("el-col"),V=m("el-row"),c=m("el-radio"),s=m("el-radio-group"),r=m("el-date-picker"),M=m("el-checkbox-group"),q=m("el-button"),x=m("el-form");return D(),Y("div",null,[a(V,null,{default:l(()=>[a(g,{span:12},{default:l(()=>[a(x,{model:t.formData,rules:t.rules,ref:"formRef","label-width":"200px",class:"formData"},{default:l(()=>[a(d,{label:"Name",prop:"name"},{default:l(()=>[a(p,{modelValue:t.formData.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.formData.name=o),placeholder:""},null,8,["modelValue"])]),_:1}),a(d,{label:"Index",prop:"indexes"},{default:l(()=>[(D(!0),Y(U,null,j(t.formData.indexes,(o,y)=>(D(),B(V,{key:y,style:{width:"100%"}},{default:l(()=>[a(g,{span:6},{default:l(()=>[a(_,{modelValue:o.checked,"onUpdate:modelValue":k=>o.checked=k,label:o.checked},{default:l(()=>[u(h(o.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),a(g,{span:12},{default:l(()=>[a(p,{type:"number",modelValue:o.require_value,"onUpdate:modelValue":k=>o.require_value=k},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(g,{span:6,style:{padding:"0 20px",color:"#aaa"}},{default:l(()=>[o.unit?(D(),Y(U,{key:0},[u(" Unit: "+h(o.unit),1)],64)):P("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(d,{label:"Status",prop:"status"},{default:l(()=>[a(s,{modelValue:t.formData.status,"onUpdate:modelValue":e[1]||(e[1]=o=>t.formData.status=o)},{default:l(()=>[a(c,{label:0},{default:l(()=>[ee]),_:1}),a(c,{label:1},{default:l(()=>[ae]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"Discovered",prop:"is_discovered"},{default:l(()=>[a(s,{modelValue:t.formData.is_discovered,"onUpdate:modelValue":e[2]||(e[2]=o=>t.formData.is_discovered=o)},{default:l(()=>[a(c,{label:0},{default:l(()=>[te]),_:1}),a(c,{label:1},{default:l(()=>[le]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"Begin",prop:"begin"},{default:l(()=>[a(r,{modelValue:t.formData.begin,"onUpdate:modelValue":e[3]||(e[3]=o=>t.formData.begin=o),type:"datetime",format:"YYYY-MM-DD HH:mm:ss",placeholder:"Select Begin Time"},null,8,["modelValue"])]),_:1}),a(d,{label:"End",prop:"end"},{default:l(()=>[a(r,{modelValue:t.formData.end,"onUpdate:modelValue":e[4]||(e[4]=o=>t.formData.end=o),type:"datetime",format:"YYYY-MM-DD HH:mm:ss",placeholder:"Select End Time"},null,8,["modelValue"])]),_:1}),a(d,{label:"Duration",prop:"duration"},{default:l(()=>[a(p,{modelValue:t.formData.duration,"onUpdate:modelValue":e[5]||(e[5]=o=>t.formData.duration=o),type:"number",placeholder:""},null,8,["modelValue"]),oe]),_:1}),a(d,{label:"Target user class",prop:"filters.classes"},{default:l(()=>[a(M,{modelValue:t.formData.filters.classes,"onUpdate:modelValue":e[6]||(e[6]=o=>t.formData.filters.classes=o)},{default:l(()=>[(D(!0),Y(U,null,j(t.allClasses,(o,y)=>(D(),B(_,{label:y,key:y},{default:l(()=>[u(h(o),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"Target user donated",prop:"filters.donate_status"},{default:l(()=>[a(M,{modelValue:t.formData.filters.donate_status,"onUpdate:modelValue":e[7]||(e[7]=o=>t.formData.filters.donate_status=o)},{default:l(()=>[a(_,{label:"no"},{default:l(()=>[se]),_:1}),a(_,{label:"yes"},{default:l(()=>[re]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"Target user register time"},{default:l(()=>[a(r,{modelValue:t.formData.filters.register_time_range,"onUpdate:modelValue":e[8]||(e[8]=o=>t.formData.filters.register_time_range=o),type:"datetimerange",format:"YYYY-MM-DD HH:mm:ss","range-separator":"to","start-placeholder":"Begin","end-placeholder":"End"},null,8,["modelValue"])]),_:1}),a(d,{label:"Description",prop:"description"},{default:l(()=>[a(p,{type:"textarea",modelValue:t.formData.description,"onUpdate:modelValue":e[9]||(e[9]=o=>t.formData.description=o),placeholder:""},null,8,["modelValue"])]),_:1}),a(d,null,{default:l(()=>[a(q,{type:"primary",onClick:e[10]||(e[10]=o=>v.submitAdd())},{default:l(()=>[ne]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})])}var fe=Q(Z,[["render",de]]);export{fe as default};
